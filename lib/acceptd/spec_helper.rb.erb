workspace_dir = "<%= workspace_dir %>"
selected_project = "<%= selected_project %>"
browser = "<%= browser %>"
driver = "<%= driver %>"
timeout_in_seconds = "<%= timeout_in_seconds %>"

require 'acceptance_test/acceptance_config'
require 'acceptance_test/acceptance_test'

ENV['CONFIG_DIR'] = "#{workspace_dir}/#{selected_project}"
ENV['DATA_DIR'] = "#{workspace_dir}/#{selected_project}/acceptance_data"

AcceptanceConfig.instance.configure("#{workspace_dir}", {
  app_name: selected_project,
  enable_external_source: true,
  ignore_case_in_steps: true
})

AcceptanceTest.instance.configure({
  browser: browser,
  driver: driver,
  timeout_in_seconds: timeout_in_seconds
})

RSpec.configure do |config|
  config.before(:each) do
    local_browser = config.instance_variable_get(:@local_browser)

    config.instance_variable_set(:@local_browser, Capybara.current_session.driver.browser) unless local_browser
  end

  config.after(:suite) do
    local_browser = config.instance_variable_get(:@local_browser)

    if local_browser
      local_browser.quit

      config.instance_variable_set(:@local_browser, nil)
    end
  end
end
